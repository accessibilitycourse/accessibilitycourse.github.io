<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>project4</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <style>
  img {
  border: 2px solid #CCC;
  margin: 2em !important;
  }
  body {
  padding: 5em 1em !important;
  }
  </style>
  <style type="text/css">
  ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c8{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c18{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c13{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c19{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:18pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c16{background-color:#ffffff;color:#000000;text-decoration:none;vertical-align:baseline;font-size:10.5pt;font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c15{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial"}.c7{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c17{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;text-align:left}.c5{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:left}.c11{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:left}.c12{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c6{font-weight:400;font-family:"Courier New"}.c14{font-weight:700;font-family:"Arial"}.c3{color:#1155cc;text-decoration:underline}.c4{color:inherit;text-decoration:inherit}.c10{color:#ff0000}.c9{font-style:italic}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}
  </style>
</head>
<body>
  <div>
    <ul>
      <a href="/">Home</a>:: <a href="/syllabus.html">Syllabus</a>
    </ul>
  </div>
  <div class="maincontent">
    <p class="c17 title" id="h.pa3nzyasjf4j"><span class="c18">Project 4:</span></p>
    <p class="c17 title" id="h.w2qjq1luhzlg"><span>A Screen Reader for the Web</span></p>
    <p class="c2"><span class="c9">Due: &#160;Thursday, October 5th &#160;*</span><span class="c9 c10">in class</span><span class="c15 c9">*</span></p>
    <p class="c0"><span class="c9 c15"></span></p>
    <p class="c2"><span class="c1">In this project, you will build a screen reader for the web. Your screen reader will have basic functions, such as being able to read straight through the content of a page, and skip forward or backward between some element types.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c1">The web makes this much easier than it would seem at first, but, as always, I encourage you to start this project early!</span></p>
    <p class="c0"><span class="c1"></span></p>
    <h2 class="c5" id="h.ak5mcqwlq3yf"><span class="c8">Resources</span></h2>
    <h3 class="c11" id="h.xceskyuskpry"><span class="c13">Videos:</span></h3>
    <p class="c2"><span class="c3">Jeff Building Basic Functions of Screen Reader in Class</span></p>
    <h3 class="c11" id="h.d8hhelvzlstt"><span class="c13">Code:</span></h3>
    <p class="c2"><span class="c3">Code from Screen Reader functions Jeff Built In Class</span></p>
    <p class="c0"><span class="c1"><br></span></p>
    <h2 class="c5" id="h.1ffj6rg7qp1w"><span class="c8">Another Chrome Extension</span></h2>
    <p class="c2"><span class="c1">The basis for this project will be a Chrome extension. To get started, copy and paste the extension that you built last week into a new directory. Enter its manifest to have a different name. I suggest something like, &#8220;Screen Reader,&#8221; and then load it into the browser.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <h2 class="c5" id="h.b3vsop3irecs"><span class="c8">Reading the Contents of a Web Page</span></h2>
    <p class="c2"><span class="c1">Reading the contents of a web page is very similar to reading the contents of a single element that you worked on before. The main difference is that you&#8217;re not just reading one element, but multiple elements in sequence. At some high level what you&#8217;ll do to make this work is figure out how to go through the contents of the page in linear order, and then just read them out as you go.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c1">The Document Object Model (DOM) is a tree version of the web page. Reading the page means to visit all of the elements in the tree, seeing if each one should be read out loud or not, and then doing that (or not). Technically, this is called traversing the tree.<br>
    <br>
    The last decision to make is what order to visit the elements in the tree. We could do it randomly, but then the page contents would be presented randomly. In computer science, we talk about trees a lot because they&#8217;re a handy data structure for all sorts of purposes. HTML (or any variant of XML) is naturally converted into a tree structure, where tags are nested inside other tags. The diagram below shows one of these trees.</span></p>
    <p class="c2"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 489.10px; height: 295.50px;"><img alt="" src="https://lh4.googleusercontent.com/HJomEZ5PVox2EaNEGZnHwZ5rN6rOIeoJPGlfxSa8KC0MV7lJLEe4_F6LUid6qoFUv83Rs2YPdBOOdCULK7oAgWE9GbnfYWRRpcdcybYuDa_IwwoSZo0azEQRpgjHMPhgKA" style="width: 489.10px; height: 295.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c1">Consider the diagram above. On this page, you probably want to read the contents of the H1 first. To get to the text contents of the H1 tag, you have to go from the HTML tag, to the BODY tag, to the H1 tag, and all the way down to the text that is at the end (leaf).<br>
    <br>
    After you read that, you&#8217;d go back up to the H1. Since there&#8217;s nothing else there, you&#8217;d go back to the BODY tag, find its next child (the DIV tag), visit its first child, and then read the text contained within it. &#160;Then you&#8217;d go back up to the P, back up to the DIV, visit the DIV&#8217;s next child, which is the H2, read the text within it. If you continue like this, you&#8217;ll end up reading the whole tree in a linear order that likely matches its presentation.<br>
    <br>
    Technical terms this is a depth-first traversal, which just means you keep drilling down before visiting other children of a node. This is in contrast to a breadth-first traversal in which you would visit each child element before visiting any of those child elements children.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c1">A subtle point is that you were technically doing a pre-order depth-first traversal because you read whatever you were going to read for the node on the way down not on the way back up. First instance, you read &#8220;heading level 1&#8221; before you read the heading&#8217;s contents.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <h2 class="c5" id="h.so4r0dlxb3rl"><span class="c8">User Interaction</span></h2>
    <p class="c2"><span>When the user presses the</span> <span class="c6">ctrl+j</span><span>, the extension should start reading from the top of the page. When they press,</span> <span class="c6">ctrl+k</span><span>, the extension should reverse direction. When the user presses the</span> <span class="c6">Escape key</span><span>, it should silence the extension. You can look at this</span> <span class="c3">Stackoverflow article on detecting the control key</span><span class="c1">.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span>Further, when the user presses</span><span class="c6">&#160;ctrl+h</span><span>&#160;the extension should jump to and read the next heading, when they press</span> <span class="c6">shift+ctrl+h</span><span>, it should jump to and read the previous heading. If there is no heading in that direction, it should read &#8220;no more headings&#8221;.<br>
    <br>
    Finally, pressing the</span> <span class="c6">tab</span><span>&#160;key should cause the extension to jump to the next &#8220;focusable&#8221; element and</span> <span class="c6">shift-tab</span><span>&#160;should cause the extension to jump to the previous &#8220;focusable&#8221; element. The easiest way to do this is probably to figure out which HTML tags are focusable, and look for those. For the purposes of this assignment, you do not need to detect elements that have an assigned tab index or that have otherwise been made focusable programmatically.<br>
    <br>
    Finally, as the user types into a form field (</span><span class="c6">&lt;input type=&#8221;text&#8221;&gt;</span><span>&#160;or</span> <span class="c6">&lt;textarea&gt;</span><span class="c1">) the extension should read allowed the character that they&#8217;re typing.<br>
    <br>
    You will want to think carefully about when to allow sounds to queue up in the synthesizer queue so that they will be eventually read, and when you should explicitly remove items from that queue. For instance, once a user has typed a second key, it probably doesn&#8217;t make sense to still read the last key. Once the user has moved on to the next heading, it probably doesn&#8217;t make sense to keep reading the last one.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <h2 class="c5" id="h.9iev7esclx40"><span class="c8">Finding the Next Element to Read</span></h2>
    <p class="c2"><span>jQuery has some handy functions that allow you to move around the DOM. Some of these include</span> <span class="c6">.next()</span><span>&#160;to go to the next sibling,</span> <span class="c6">.previous()</span><span>&#160;to go to the prior sibling, and</span> <span class="c6">.parent()</span><span class="c1">&#160;to go to the parent of the element.</span></p>
    <p class="c2"><span><br>
    Many elements don&#8217;t result in anything being read,</span> <span class="c9">i.e.</span><span>, &lt;p&gt;, &lt;div&gt;, etc.<br>
    <br></span> <span class="c3">Video of Jeff demonstrating how to navigate through the DOM</span><span>.<br>
    <br>
    An alternative is to have jQuery do the heavy lifting, which is what I recommend you do. In this example, we&#8217;re able to find all the elements following (or, preceding) a given element, based on this</span> <span class="c3">StackOverflow answer</span><span>:<br>
    <br></span> <span class="c7 c6">var start = '#start';</span></p>
    <p class="c2"><span class="c7 c6">var all = 'p';</span></p>
    <p class="c2"><span class="c7 c6">var index;</span></p>
    <p class="c0"><span class="c7 c6"></span></p>
    <p class="c2"><span class="c7 c6">var afters = $(all).add(start).each(function (i) {</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; if ($(this).is(start)var start = '#start';</span></p>
    <p class="c2"><span class="c7 c6">var all = 'p';</span></p>
    <p class="c2"><span class="c7 c6">var index;</span></p>
    <p class="c0"><span class="c7 c6"></span></p>
    <p class="c2"><span class="c7 c6">var afters = $(all).add(start).each(function (i) {</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; if ($(this).is(start)) {</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; &#160; &#160; index = i;</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; &#160; &#160; return false; // quit looping early</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; }</span></p>
    <p class="c2"><span class="c6 c7">}).slice(index + 1);) {</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; &#160; &#160; index = i;</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; &#160; &#160; return false; // quit looping early</span></p>
    <p class="c2"><span class="c7 c6">&#160; &#160; }</span></p>
    <p class="c2"><span class="c7 c6">}).slice(index + 1);</span></p>
    <p class="c2"><span><br>
    One problem is this is that the performance is likely to be pretty poor on large web sites. To improve performance, you might only perform this expensive operation every once in awhile, but then you run the risk of it not exactly matching the DOM of the live web page. What you have created in practice is an</span> <span class="c3">off-screen model</span><span>! &#160;Sure, it&#8217;s easier to work with than the DOM, but that comes at the price of maybe not exactly matching the underlying content.<br>
    <br>
    Here is the code we developed in class for doing this:<br></span><span class="c6 c16">function readFromBeginning() {<br>
    &#160;allelements = $("*");<br>
    &#160;currentelem_index = 0;<br>
    <br>
    &#160;currentstate = "READING";<br>
    <br>
    &#160;findTheNextOne();<br>
    }<br>
    <br>
    <br>
    function findTheNextOne() {<br>
    &#160;do {<br>
    &#160; &#160;var currentelem = allelements[currentelem_index];<br>
    &#160; &#160;currentelem_index++;<br>
    <br>
    &#160; &#160;if(currentelem_index&gt;100) {<br>
    &#160; &#160; &#160;break;<br>
    &#160; &#160;}<br>
    &#160;} while(!doesItSpeak(currentelem));<br>
    <br>
    &#160;speakMe(currentelem); &#160;<br>
    }</span></p>
    <p class="c2"><span><br>
    This approach works by first generating a list of all the elements in the page (the line with</span> <span class="c6">$(&#8220;*&#8221;)</span><span>) and then just moving forward and backward in that array. So, if you want to find the next element that you should read, you just go forward in the array until you find an element that has something to speak. If you want to go backward, you just go backwards through that array until you find something that can speak.<br>
    <br>
    So, for instance, if you save the result of</span> <span class="c6">$(&#8220;*&#8221;)</span><span>, which is an array of all the elements on the page in the correct order, to a variable, you can then go forward and back through the page by going forward or backward through that array.<br>
    <br></span> <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 543.00px; height: 142.00px;"><img alt='var allelements = $("*") undefined allelements (268) [html, head, meta, title, script, script, style, style, body.c19, div, ul, a, a, div.maincontent, p#h.hxvgegbtvmf.c7.title, span.c1.c18, p#h.wqy2hux8v33s.c7.title, span.c1, p.c5, span.c0, p.c16, span.c0, br, p.c16, span, span.c14, a.c11, span.c0, p.c5, span.c0, p.c16, span, span.c14, a.c11, span, p.c5, span.c0, p.c16, span, img, span, img, span, img, h2#h.kjx1b8tjwivx.c17, span.c18.c22, p.c16, span.c15, p.c5, span.c18.c6.c20, p.c5, span.c18.c20.c6, h3#h.yqyl8lch51a8.c9, span.c6, span.c10, p.c2, span.c0, p.c2.c8, span.c0, p.c2, span, span.c14, a.c11, span.c0, p.c2.c8, span.c0, p.c2, span, span.c14, a.c11, span, p.c5, span.c0, p.c5, span.c0, p.c5, span.c0, h3#h.obq06nuegrfa.c9, span.c6, span.c10, p.c2, span.c0, p.c2.c8, span.c0, p.c2, span.c14, a.c11, span.c0, p.c2.c8, span.c0, p.c2, span.c14, a.c11, span, p.c2.c8, span.c0, p.c2, span.c14, a.c11, span.c0,&#160;&#8230;] allelements[4] &lt;script async src=&#8203;"https:&#8203;/&#8203;/&#8203;www.google-analytics.com/&#8203;analytics.js"&gt;&#8203;&lt;/script&gt;&#8203;' src="https://lh4.googleusercontent.com/7o23O2hGRpc6Qm0m6x6uq5G2qjvIoElj21AUaOd6KGl-WcvWy9XmV2q7B52_1ko75SkIFCBXSanwjgL2AwoMNoCqoULHM7WcF0-n4-Cz6vLw2dxyrSupU6RAwvhuuFQLvQ" style="width: 543.00px; height: 142.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="Console output for getting all nodes, and accessing one of them."></span><span><br></span></p>
    <h2 class="c5" id="h.bo556hd8cnrg"><span class="c8">Keeping Track of State</span></h2>
    <p class="c2"><span class="c1">While there are almost certainly more elegant ways to keep track of the state of the application, I think the easiest way is to keep track of state like the current node being read and what the application is doing (reading, forward or backward, etc) in a couple of global variables.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c1">That way you&#8217;ll know where you are in the page, and you&#8217;ll know what you should do next (if anything), once, say, an event fires to say that a sound has stopped playing.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span>In the code I developed, I decided there were probably five different states that the screen reader could be in:<br></span><span class="c7 c6">var currentstate =</span></p>
    <p class="c2"><span class="c6">"PAUSED"; &#160;// READING, READINGBACKWARD, READONEFORWARD, READONEBACK<br>
    <br></span> <span class="c1">There&#8217;s nothing special about this variable or setting it. It&#8217;s just a way for you to keep track of what the screen reader should be doing right now, and to coordinate the various components in your code so they&#8217;re doing the right thing given that state.</span></p>
    <h2 class="c5" id="h.4eq58dimrhzs"><span class="c8">When to Continue Reading</span></h2>
    <p class="c2"><span class="c1">One of the challenges of this assignment is that you&#8217;ll need to write your program so it can operate asynchronously. That is, you&#8217;ll do things like wait for a keydown event, and then start reading. Your extension will read one element&#8217;s contents, and you&#8217;ll only start reading the next</span></p>
    <p class="c2"><span class="c1">once it&#8217;s done.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c1">To do that, you can use the same basic structure you used in the last assignment to generate speech, but you&#8217;ll call it slightly differently in order to set an event for when the speech is done playing. When it&#8217;s done, you&#8217;ll need to tell it to find and then play the next element&#8217;s sound.</span></p>
    <p class="c0"><span class="c1"></span></p>
    <p class="c2"><span class="c7 c6">var u = new SpeechSynthesisUtterance();</span></p>
    <p class="c2"><span class="c7 c6">u.onend = function(event) {</span></p>
    <p class="c2"><span class="c7 c6">&#160; alert('Finished in ' + event.elapsedTime + ' seconds.');<br>
    }</span></p>
    <p class="c2"><span class="c7 c6">speechSynthesis.speak(u);</span></p>
    <p class="c0"><span class="c7 c14"></span></p>
    <p class="c0"><span class="c1"></span></p>
    <h2 class="c5" id="h.ky69dwrhvesw"><span class="c8">Grading</span></h2>
    <p class="c2"><span class="c1">Main components of our grading will be:<br></span></p>
    <p class="c2"><span class="c1">Using the appropriate keyboard commands, does the following happen:<br>
    1. &#160;Reads forward through the page</span></p>
    <p class="c2"><span class="c1">2. &#160;Reads backward through the page</span></p>
    <p class="c2"><span class="c1">3. &#160;Jumps forward by heading</span></p>
    <p class="c2"><span class="c1">4. &#160;Jumps backward by heading</span></p>
    <p class="c2"><span class="c1">5. &#160;Jumps forward by focusable element</span></p>
    <p class="c2"><span class="c1">6. &#160;Jumps backward by focusable element</span></p>
    <p class="c2"><span class="c1">7. &#160;Reads characters as they are typed into form fields</span></p>
    <p class="c2"><span class="c1">8. &#160;Clears the queue of sounds when appropriate so they don&#8217;t &#8220;back up&#8221;</span></p>
  </div>
  <div style="height: 30px;"></div>
  <hr>
  <p><span>This page and contents are copyright Jeffrey P. Bigham except where noted.<br></span></p>
</body>
</html>
